syntax = "proto3";

package com.intentevolved;

// Kotlin/Java classes will be generated under com.intentevolved
option java_package = "com.intentevolved";
option java_multiple_files = true;

message IntentStream {
  Header header = 1;
  repeated Op ops = 2;
}


message Header {
  // a text description of the end intent of the whole stream
  // this object is effectively an intent with id '0'
  string rootIntent = 1;
  // todo: other details, like who wrote it, date started, etc

}
message Op {
  oneof payload {
    CreateIntent create_intent = 1;
    UpdateIntentText update_intent = 2;
    DeleteIntent delete_intent = 3;
    FulfillIntent fulfill_intent = 4;
    UpdateIntentParent update_intent_parent = 5;
  }
  // bump field numbers up here to leave space for more messages
  optional int64 timestamp_epoch_nanos = 1000;
}

message CreateIntent {
  int64 id = 1; // this will be provided by the service
  string text = 2;
  // having a parent is optional
  // if you don't explicitly specify a parent, the 'root' intent is the parent
  optional int64 parentId = 3;
}

message UpdateIntentText {
  int64 id = 1;
  string new_text = 2;
}

message UpdateIntentParent {
  int64 id = 1;
  int64 parentId = 2;
}

message DeleteIntent {
  int64 id = 1;
}

// eventually this will become more complex
// once the stream works for multiple authors, there'll be a mechanism where
// - one agent says, I've fullfilled the intent
// - stream owner says "i've confirmed this fulfilled the intent"
message FulfillIntent {
  int64 id = 1;
}
